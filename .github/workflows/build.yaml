name: 生成中国IP段IPSET转储文件

on:
  workflow_dispatch:
  schedule:
    - cron:  '0 4 */3 * *'

jobs:
  build:
    name: 任务
    runs-on: ubuntu-latest
    steps:
    - name: 步骤一下载中国IP段
      run: |
        curl -LR -o CN-ip-cidr.txt "https://github.com/Hackl0us/GeoIP2-CN/raw/release/CN-ip-cidr.txt"
        
    - name: 步骤二创建IPSET
      run: |
        ipset create CHINA:CIDR hash:net

    - name: 步骤三导入中国IP段
      run: |
        bash <<EOF
        for item in $(cat CN-ip-cidr.txt); do
            ipset add CHINA:CIDR $item
        done
        EOF

    - name: 步骤四导出中国IP段IPSET转储文件
      run: |
        bash <<EOF
        ipset save CHINA:CIDR > china_cidr_ipset.txt
        EOF