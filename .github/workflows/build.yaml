name: 生成中国IP段IPSET转储文件

on:
  workflow_dispatch:
  schedule:
    - cron:  '0 4 */3 * *'

jobs:
  build:
    name: 任务
    runs-on: ubuntu-latest
    steps:
    - name: 拉取代码
      uses: actions/checkout@v4

    - name: 执行脚本
      run: |
        sudo bash build.sh

    - name: 构件归档到发布分支
      run: |
          git config --local user.email "4288666+Xuchengen@users.noreply.github.com"
          git config --local user.name "工作流机器人🤖"
          
          git fetch
          git checkout release
        
          cp -rf dist/china_cidr_ipset.txt ./
          
          git add china_cidr_ipset.txt
          git commit -am "更新于$(date)"

    - name: GitHub推送
      uses: ad-m/github-push-action@v0.6.0
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: release
        force: true